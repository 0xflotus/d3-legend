<!DOCTYPE html>
<meta charset="utf-8">
<style>

text {
  font: 14px sans-serif;
}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="../legend.js"></script>
<script>


var svg = d3.select("body").append("svg")
    .attr("width", 500)
    .attr("height", 900);

var color;

color = function(d){
  return color.range(d);

}

color.domain = function() { return ["Home", "Post-Play", "Search", "Kids Area", "Unknown", "Kids Area - Post Play", "Alt Genre", "In Player", "Kids Area - Character", "MDP(Sims)", "Kids Area - Search", "My List", "MDX", "Others", "New Releases", "Recently Watched", "0"].sort()};

color.range = function(d){

  var colors = ["rgb(56, 106, 197)","rgb(12, 124, 182)",
    "rgb(90, 177, 223)",
    "rgb(102, 197, 190)", "rgb(153, 107, 195)", "rgb(34, 72, 115)",
    "rgb(208, 172, 59)", "rgb(93, 199, 76)", "rgb(48, 155, 82)",
    "rgb(91, 71, 140)", "rgb(234, 117, 166)", "rgb(211, 94, 79)",
    "rgb(228, 136, 59)", "rgb(103, 95, 210)",
    "rgb(170, 208, 59)","rgb(232, 200, 36)", "rgb(23, 136, 145)",
    "rgb(165, 45, 29)"];

  var charLower = 98, //lowerbound valid code, reps "a"
  charUpper = 122, //upperbound valid code, reps "z"
  charToHue = d3.scale.ordinal().domain(color.domain()).range(colors),
  //charToHue = d3.scale.quantize().domain([charLower + 4, charUpper - 6]).range(colors)
  validChars = 0;

  var total = d.toLowerCase().split('').reduce(
    function(previous, current, i){

      var code = current.charCodeAt(0) +
                ((current === "s") ? 10 : 0);
      if ( charLower <= code && charUpper >= code){
        validChars = validChars + (i+1);
        return previous + code*(i+1);
      } else {
        return previous;
      }

  }, 0)


  var adjustor = (validChars%2)? -1: 1;
  return charToHue(d);
  //return charToHue((total/validChars) + adjustor*2 ) || "#aaa" ;
};


svg.append("g")
        .attr("class", "legend")
        .attr("transform", "translate(20,20)");

var legend = d3.svg.legend()
    .shapeWidth(35)
    .shapeHeight(35)
    .scale(color);


svg.select(".legend")
  .call(legend);


</script>

