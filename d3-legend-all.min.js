function d3_identity(a){return a}function d3_mergeLabels(a,b){if(0===b.length)return a;a=a?a:[];for(var c=b.length;c<a.length;c++)b.push(a[c]);return b}function d3_linearLegend(a,b,c){var d=[];if(b.length>1)d=b;else for(var e=a.domain(),f=(e[1]-e[0])/(b-1),g=0;b>g;g++)d.push(c(e[0]+g*f));return{data:d,labels:d,feature:function(b){return a(b)}}}function d3_quantLegend(a,b){var c=a.range().map(function(c){var d=a.invertExtent(c);return b(d[0])+" to "+b(d[1])});return{data:a.range(),labels:c,feature:d3_identity}}function d3_ordinalLegend(a){return{data:a.domain(),labels:a.domain(),feature:function(b){return a(b)}}}function d3_drawShapes(a,b,c,d,e,f){"rect"===a?b.attr("height",c).attr("width",d):"circle"===a?b.attr("r",e):"line"===a?b.attr("x1",0).attr("x2",d).attr("y1",0).attr("y2",0):"path"===a&&b.attr("d",f)}function d3_addText(a,b,c){b.append("text").attr("class","label"),a.selectAll("g.cell text").data(c).text(d3_identity)}function d3_calcType(a,b,c,d){var e=a.ticks?d3_linearLegend(a,b,d):a.invertExtent?d3_quantLegend(a,d):d3_ordinalLegend(a);return e.labels=d3_mergeLabels(e.labels,c),e}function d3_placement(a,b,c,d,e){b.attr("transform",c),d.attr("transform",e),"horizontal"===a&&d.style("text-anchor","middle")}d3.legend={},d3.legend.color=function(){function a(a){var o=d3_calcType(c,i,j,l),p=a.selectAll(".cell").data(o.data),q=p.enter().append("g",".cell").attr("class","cell").style("opacity",1e-6);shapeEnter=q.append(d).attr("class","swatch"),shapes=p.select("g.cell "+d),p.exit().transition().style("opacity",0).remove(),d3_drawShapes(d,shapes,f,e,g,b),d3_addText(a,q,o.labels);var r=p.select("text"),s=shapes[0].map(function(a){return a.getBBox()});k?shapes.attr("class",function(a){return"swatch "+o.feature(a)}):"line"==d?shapes.style("stroke",o.feature):shapes.style("fill",o.feature);var t,u;"vertical"===n?(t=function(a,b){return"translate(0, "+b*(s[b].height+h)+")"},u=function(a,b){return"translate("+(s[b].width+s[b].x+m)+","+(s[b].y+s[b].height/2+5)+")"}):"horizontal"===n&&(t=function(a,b){return"translate("+b*(s[b].width+h)+",0)"},u=function(a,b){return"translate("+(s[b].width/2+s[b].x)+","+(s[b].height+s[b].y+m+8)+")"}),d3_placement(n,p,t,r,u),p.transition().style("opacity",1)}var b,c=d3.scale.linear(),d="rect",e=15,f=15,g=10,h=2,i=[5],j=[],k=!1,l=d3.format(".01f"),m=10,n="vertical";return a.scale=function(b){return arguments.length?(c=b,a):a},a.cells=function(b){return arguments.length?((b.length>1||b>=2)&&(i=b),a):a},a.shape=function(c,e){return arguments.length?(("rect"==c||"circle"==c||"line"==c||"path"==c&&"string"==typeof e)&&(d=c,b=e),a):a},a.shapeWidth=function(b){return arguments.length?(e=+b,a):a},a.shapeHeight=function(b){return arguments.length?(f=+b,a):a},a.shapeRadius=function(b){return arguments.length?(g=+b,a):a},a.shapePadding=function(b){return arguments.length?(h=+b,a):a},a.labels=function(b){return arguments.length?(j=b,a):a},a.labelFormat=function(b){return arguments.length?(l=b,a):a},a.labelOffset=function(b){return arguments.length?(m=+b,a):a},a.useClass=function(b){return arguments.length?((b===!0||b===!1)&&(k=b),a):a},a.orient=function(b){return arguments.length?(b=b.toLowerCase(),("horizontal"==b||"vertical"==b)&&(n=b),a):a},a},d3.legend.size=function(){function a(a){var o=d3_calcType(c,i,j,l),p=a.selectAll(".cell").data(o.data),q=p.enter().append("g",".cell").attr("class","cell").style("opacity",1e-6);shapeEnter=q.append(d).attr("class","swatch"),shapes=p.select("g.cell "+d),p.exit().transition().style("opacity",0).remove(),k?(d3_drawShapes(d,shapes,f,e,g,b),shapes.attr("stroke-width",o.feature)):d3_drawShapes(d,shapes,o.feature,o.feature,o.feature,b),d3_addText(a,q,o.labels);var r,s,t=p.select("text"),u=shapes[0].map(function(a,b){var d=a.getBBox(),e=c(o.data[b]);return k&&"horizontal"===n?d.height=d.height+e/2:k&&"vertical"===n&&(d.width=d.width+e/2),d});"vertical"===n?(r=function(a,b){var c=d3.sum(u.slice(0,b+1),function(a){return a.height});return"translate(0, "+(c+b*h)+")"},s=function(a,b){return"translate("+(u[b].width+u[b].x+m)+","+(u[b].y+u[b].height/2+5)+")"}):"horizontal"===n&&(r=function(a,b){var c=d3.sum(u.slice(0,b+1),function(a){return a.width});return"translate("+(c+b*h)+",0)"},s=function(a,b){return"translate("+(u[b].width/2+u[b].x)+","+(u[b].height+u[b].y+m+8)+")"}),d3_placement(n,p,r,t,s),p.transition().style("opacity",1)}var b,c=d3.scale.linear(),d="rect",e=15,f=15,g=10,h=2,i=[5],j=[],k=!1,l=d3.format(".01f"),m=10,n="vertical";return a.scale=function(b){return arguments.length?(c=b,a):a},a.cells=function(b){return arguments.length?((b.length>1||b>=2)&&(i=b),a):a},a.useStroke=function(b){return arguments.length?((b===!0||b===!1)&&(k=b),a):a},a.shape=function(c,e){return arguments.length?(("rect"==c||"circle"==c||"line"==c||"path"==c&&"string"==typeof e)&&(d=c,b=e),a):a},a.shapeWidth=function(b){return arguments.length?(e=+b,a):a},a.shapeHeight=function(b){return arguments.length?(f=+b,a):a},a.shapeRadius=function(b){return arguments.length?(g=+b,a):a},a.shapePadding=function(b){return arguments.length?(h=+b,a):a},a.labels=function(b){return arguments.length?(j=b,a):a},a.labelFormat=function(b){return arguments.length?(l=b,a):a},a.labelOffset=function(b){return arguments.length?(m=+b,a):a},a.orient=function(b){return arguments.length?(b=b.toLowerCase(),("horizontal"==b||"vertical"==b)&&(n=b),a):a},a},d3.legend.symbol=function(){function a(a){var m=d3_calcType(b,h,i,j),n=a.selectAll(".cell").data(m.data),o=n.enter().append("g",".cell").attr("class","cell").style("opacity",1e-6);shapeEnter=o.append(c).attr("class","swatch"),shapes=n.select("g.cell "+c),n.exit().transition().style("opacity",0).remove(),d3_drawShapes(c,shapes,e,d,f,m.feature),d3_addText(a,o,m.labels);var p,q,r=n.select("text"),s=shapes[0].map(function(a){return a.getBBox()}),t=d3.max(s,function(a){return a.height}),u=d3.max(s,function(a){return a.width});"vertical"===l?(p=function(a,b){return"translate(0, "+b*(t+g)+")"},q=function(a,b){return"translate("+(u+k)+","+(s[b].y+s[b].height/2+5)+")"}):"horizontal"===l&&(p=function(a,b){return"translate("+b*(u+g)+",0)"},q=function(a,b){return"translate("+(s[b].width/2+s[b].x)+","+(t+k)+")"}),d3_placement(l,n,p,r,q),n.transition().style("opacity",1)}var b=d3.scale.linear(),c="path",d=15,e=15,f=10,g=5,h=[5],i=[],j=d3.format(".01f"),k=10,l="vertical";return a.scale=function(c){return arguments.length?(b=c,a):a},a.cells=function(b){return arguments.length?((b.length>1||b>=2)&&(h=b),a):a},a.shapePadding=function(b){return arguments.length?(g=+b,a):a},a.labels=function(b){return arguments.length?(i=b,a):a},a.labelFormat=function(b){return arguments.length?(j=b,a):a},a.labelOffset=function(b){return arguments.length?(k=+b,a):a},a.orient=function(b){return arguments.length?(b=b.toLowerCase(),("horizontal"==b||"vertical"==b)&&(l=b),a):a},a};